{"version":3,"file":"api.js","sources":["services/api.js"],"sourcesContent":["// 基础云函数/HTTP调用封装\r\n// 可在 HBuilderX 中替换为 uniCloud.callFunction 或 uni.request\r\nexport function callApi({ api, data = {}, loading = false }) {\r\n  // 占位：统一错误处理/Loading\r\n  if (loading) uni.showLoading({ title: \"加载中\" });\r\n  return new Promise((resolve, reject) => {\r\n    uniCloud\r\n      .callFunction({\r\n        name: api,\r\n        data,\r\n      })\r\n      .then((res) => {\r\n        if (loading) uni.hideLoading();\r\n        const r = res.result;\r\n        if (r && typeof r === \"object\" && \"success\" in r) {\r\n          if (r.success) return resolve(r.data);\r\n          uni.showToast({ title: r.errorMessage || \"错误\", icon: \"none\" });\r\n          return reject(r.errorMessage);\r\n        }\r\n        // 兼容直接返回数据对象的云函数\r\n        resolve(r);\r\n      })\r\n      .catch((err) => {\r\n        if (loading) uni.hideLoading();\r\n        uni.showToast({ title: \"网络错误\", icon: \"none\" });\r\n        reject(err);\r\n      });\r\n  });\r\n}\r\n\r\nexport const groupService = {\r\n  getMyGroup() {\r\n    return callApi({ api: \"getMyGroup\" });\r\n  },\r\n  listGroups() {\r\n    return callApi({ api: \"getManyGroup\", loading: true });\r\n  },\r\n  createGroup(form) {\r\n    return callApi({ api: \"createGroup\", data: form, loading: true });\r\n  },\r\n  joinGroup(form) {\r\n    return callApi({ api: \"joinGroup\", data: form, loading: true });\r\n  },\r\n  groupMembers(groupId) {\r\n    return callApi({ api: \"getManyForm\", data: { groupId }, loading: true });\r\n  },\r\n  updateProfile(profile) {\r\n    return callApi({ api: \"updateProfile\", data: profile, loading: true });\r\n  },\r\n};\r\n\r\nexport const messageService = {\r\n  listPublic() {\r\n    return callApi({ api: \"message\", data: { action: \"list\" }, loading: true });\r\n  },\r\n  publish(content) {\r\n    return callApi({\r\n      api: \"message\",\r\n      data: { action: \"publish\", content },\r\n      loading: true,\r\n    });\r\n  },\r\n};\r\n\r\nexport const dietService = {\r\n  addDiet(record) {\r\n    return callApi({ api: \"diet\", data: record });\r\n  },\r\n  dailyDiet(date) {\r\n    return callApi({ api: \"diet\", data: { date }, loading: true });\r\n  },\r\n};\r\n\r\nexport const sportService = {\r\n  addSport(record) {\r\n    return callApi({ api: \"sport\", data: record });\r\n  },\r\n  dailySport(date) {\r\n    return callApi({ api: \"sport\", data: { date }, loading: true });\r\n  },\r\n};\r\n\r\nexport const reportService = {\r\n  generate(dateRange) {\r\n    return callApi({ api: \"report\", data: dateRange, loading: true });\r\n  },\r\n  aiSummary(reportId) {\r\n    return callApi({ api: \"aiSummary\", data: { reportId }, loading: true });\r\n  },\r\n};\r\n"],"names":["uni","uniCloud"],"mappings":";;AAEO,SAAS,QAAQ,EAAE,KAAK,OAAO,CAAA,GAAI,UAAU,SAAS;AAE3D,MAAI;AAASA,kBAAAA,MAAI,YAAY,EAAE,OAAO,MAAK,CAAE;AAC7C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCC,kBAAQ,GACL,aAAa;AAAA,MACZ,MAAM;AAAA,MACN;AAAA,IACR,CAAO,EACA,KAAK,CAAC,QAAQ;AACb,UAAI;AAASD,4BAAI;AACjB,YAAM,IAAI,IAAI;AACd,UAAI,KAAK,OAAO,MAAM,YAAY,aAAa,GAAG;AAChD,YAAI,EAAE;AAAS,iBAAO,QAAQ,EAAE,IAAI;AACpCA,4BAAI,UAAU,EAAE,OAAO,EAAE,gBAAgB,MAAM,MAAM,OAAM,CAAE;AAC7D,eAAO,OAAO,EAAE,YAAY;AAAA,MAC7B;AAED,cAAQ,CAAC;AAAA,IACjB,CAAO,EACA,MAAM,CAAC,QAAQ;AACd,UAAI;AAASA,4BAAI;AACjBA,oBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAC7C,aAAO,GAAG;AAAA,IAClB,CAAO;AAAA,EACP,CAAG;AACH;AAEY,MAAC,eAAe;AAAA,EAC1B,aAAa;AACX,WAAO,QAAQ,EAAE,KAAK,aAAc,CAAA;AAAA,EACrC;AAAA,EACD,aAAa;AACX,WAAO,QAAQ,EAAE,KAAK,gBAAgB,SAAS,KAAI,CAAE;AAAA,EACtD;AAAA,EACD,YAAY,MAAM;AAChB,WAAO,QAAQ,EAAE,KAAK,eAAe,MAAM,MAAM,SAAS,KAAI,CAAE;AAAA,EACjE;AAAA,EACD,UAAU,MAAM;AACd,WAAO,QAAQ,EAAE,KAAK,aAAa,MAAM,MAAM,SAAS,KAAI,CAAE;AAAA,EAC/D;AAAA,EACD,aAAa,SAAS;AACpB,WAAO,QAAQ,EAAE,KAAK,eAAe,MAAM,EAAE,WAAW,SAAS,KAAI,CAAE;AAAA,EACxE;AAAA,EACD,cAAc,SAAS;AACrB,WAAO,QAAQ,EAAE,KAAK,iBAAiB,MAAM,SAAS,SAAS,KAAI,CAAE;AAAA,EACtE;AACH;AAEY,MAAC,iBAAiB;AAAA,EAC5B,aAAa;AACX,WAAO,QAAQ,EAAE,KAAK,WAAW,MAAM,EAAE,QAAQ,OAAQ,GAAE,SAAS,KAAM,CAAA;AAAA,EAC3E;AAAA,EACD,QAAQ,SAAS;AACf,WAAO,QAAQ;AAAA,MACb,KAAK;AAAA,MACL,MAAM,EAAE,QAAQ,WAAW,QAAS;AAAA,MACpC,SAAS;AAAA,IACf,CAAK;AAAA,EACF;AACH;AAEY,MAAC,cAAc;AAAA,EACzB,QAAQ,QAAQ;AACd,WAAO,QAAQ,EAAE,KAAK,QAAQ,MAAM,OAAM,CAAE;AAAA,EAC7C;AAAA,EACD,UAAU,MAAM;AACd,WAAO,QAAQ,EAAE,KAAK,QAAQ,MAAM,EAAE,QAAQ,SAAS,KAAI,CAAE;AAAA,EAC9D;AACH;AAEY,MAAC,eAAe;AAAA,EAC1B,SAAS,QAAQ;AACf,WAAO,QAAQ,EAAE,KAAK,SAAS,MAAM,OAAM,CAAE;AAAA,EAC9C;AAAA,EACD,WAAW,MAAM;AACf,WAAO,QAAQ,EAAE,KAAK,SAAS,MAAM,EAAE,QAAQ,SAAS,KAAI,CAAE;AAAA,EAC/D;AACH;AAEY,MAAC,gBAAgB;AAAA,EAC3B,SAAS,WAAW;AAClB,WAAO,QAAQ,EAAE,KAAK,UAAU,MAAM,WAAW,SAAS,KAAI,CAAE;AAAA,EACjE;AAAA,EACD,UAAU,UAAU;AAClB,WAAO,QAAQ,EAAE,KAAK,aAAa,MAAM,EAAE,YAAY,SAAS,KAAI,CAAE;AAAA,EACvE;AACH;;;;;;"}