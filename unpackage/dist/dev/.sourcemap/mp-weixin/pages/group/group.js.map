{"version":3,"file":"group.js","sources":["pages/group/group.vue","../../../hbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ3JvdXAvZ3JvdXAudnVl"],"sourcesContent":["<template>\r\n  <view class=\"p-3\">\r\n    <view class=\"card\" v-if=\"!groupId\">\r\n      <input v-model=\"form.nickname\" placeholder=\"昵称\" />\r\n      <textarea v-model=\"form.info\" placeholder=\"简介/目标\" />\r\n      <button class=\"mt-2\" @click=\"create\">创建小组</button>\r\n    </view>\r\n    <view class=\"card\" v-else>\r\n      <view>当前小组：{{ groupId }}</view>\r\n      <button class=\"mt-2\" @click=\"loadMembers\">刷新成员</button>\r\n      <view class=\"mt-2\" v-for=\"u in members\" :key=\"u._id\">\r\n        {{ u.nickname }} {{ u.isLeader ? \"(组长)\" : \"\" }}\r\n      </view>\r\n    </view>\r\n    <view class=\"card mt-2\">\r\n      <view>我的资料</view>\r\n      <input v-model=\"myProfile.nickname\" placeholder=\"昵称\" />\r\n      <textarea v-model=\"myProfile.info\" placeholder=\"个人简介\" />\r\n      <button\r\n        class=\"mt-2\"\r\n        :disabled=\"!groupId || profileSaving\"\r\n        @click=\"saveProfile\"\r\n      >\r\n        {{ profileSaving ? \"保存中...\" : \"保存资料\" }}\r\n      </button>\r\n      <view class=\"tips\" v-if=\"!groupId\">加入或创建小组后可保存</view>\r\n    </view>\r\n    <view class=\"card mt-2\">\r\n      <view>加入已有小组</view>\r\n      <input v-model=\"joinId\" placeholder=\"输入小组ID\" />\r\n      <input v-model=\"joinNickname\" placeholder=\"你的昵称\" />\r\n      <button class=\"mt-2\" @click=\"join\">加入</button>\r\n    </view>\r\n    <view class=\"card mt-2\">\r\n      <button @click=\"list\">获取可加入小组列表</button>\r\n      <view\r\n        class=\"mt-2\"\r\n        v-for=\"g in groups\"\r\n        :key=\"g.groupId\"\r\n        @click=\"quickJoin(g.groupId)\"\r\n      >\r\n        #{{ g.groupId }} {{ g.leader }} ({{ g.member || 1 }}人)\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n<script setup>\r\nimport { reactive, ref } from \"vue\";\r\nimport { onShow } from \"@dcloudio/uni-app\";\r\nimport { groupService } from \"../../services/api.js\";\r\n\r\nconst groupId = ref(\"\");\r\nconst members = ref([]);\r\nconst groups = ref([]);\r\nconst form = reactive({ nickname: \"\", info: \"\" });\r\nconst joinId = ref(\"\");\r\nconst joinNickname = ref(\"\");\r\nconst myProfile = reactive({ nickname: \"\", info: \"\" });\r\nconst profileSaving = ref(false);\r\n\r\nconst applyProfile = (profile = {}) => {\r\n  const nickname = profile.nickname || \"\";\r\n  const info = profile.info || \"\";\r\n  myProfile.nickname = nickname;\r\n  myProfile.info = info;\r\n  if (!form.nickname) form.nickname = nickname;\r\n  if (!form.info) form.info = info;\r\n  if (!joinNickname.value) joinNickname.value = nickname;\r\n};\r\n\r\nconst loadMembers = async () => {\r\n  if (!groupId.value) return;\r\n  try {\r\n    const res = await groupService.groupMembers(groupId.value);\r\n    members.value = res.userList || [];\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst loadMyGroup = async () => {\r\n  try {\r\n    const res = await groupService.getMyGroup();\r\n    groupId.value = res.groupId || \"\";\r\n    applyProfile(res.profile || {});\r\n    if (groupId.value) {\r\n      await loadMembers();\r\n    }\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst create = async () => {\r\n  if (!form.nickname || !form.info) {\r\n    uni.showToast({ title: \"请填写完整\", icon: \"none\" });\r\n    return;\r\n  }\r\n  try {\r\n    const res = await groupService.createGroup({\r\n      nickname: form.nickname,\r\n      info: form.info,\r\n    });\r\n    groupId.value = res.groupId;\r\n    applyProfile({ nickname: form.nickname, info: form.info });\r\n    await loadMembers();\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst join = async () => {\r\n  if (!joinId.value || !joinNickname.value) {\r\n    uni.showToast({ title: \"缺少信息\", icon: \"none\" });\r\n    return;\r\n  }\r\n  try {\r\n    const res = await groupService.joinGroup({\r\n      groupId: Number(joinId.value),\r\n      nickname: joinNickname.value,\r\n      info: \"\",\r\n      gender: \"\",\r\n      code: \"\",\r\n      age: 0,\r\n      region: [],\r\n    });\r\n    groupId.value = res.groupId;\r\n    applyProfile({ nickname: joinNickname.value, info: \"\" });\r\n    await loadMembers();\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst list = async () => {\r\n  try {\r\n    const res = await groupService.listGroups();\r\n    groups.value = res.groupList || [];\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst quickJoin = (id) => {\r\n  joinId.value = String(id);\r\n};\r\n\r\nconst saveProfile = async () => {\r\n  if (!groupId.value) {\r\n    uni.showToast({ title: \"加入小组后可保存\", icon: \"none\" });\r\n    return;\r\n  }\r\n  if (!myProfile.nickname) {\r\n    uni.showToast({ title: \"请输入昵称\", icon: \"none\" });\r\n    return;\r\n  }\r\n  try {\r\n    profileSaving.value = true;\r\n    const res = await groupService.updateProfile({\r\n      nickname: myProfile.nickname,\r\n      info: myProfile.info,\r\n    });\r\n    applyProfile(res || {});\r\n    uni.showToast({ title: \"已更新\", icon: \"success\" });\r\n    await loadMembers();\r\n  } catch (e) {\r\n    console.error(e);\r\n  } finally {\r\n    profileSaving.value = false;\r\n  }\r\n};\r\n\r\nonShow(loadMyGroup);\r\n</script>\r\n<style scoped>\r\ninput,\r\ntextarea {\r\n  border: 1px solid #eee;\r\n  padding: 12rpx;\r\n  border-radius: 8rpx;\r\n  margin-top: 12rpx;\r\n  width: 100%;\r\n}\r\nbutton {\r\n  background: #1afa29;\r\n  color: #fff;\r\n  padding: 16rpx;\r\n  border-radius: 8rpx;\r\n}\r\nbutton:disabled {\r\n  background: #9ed6a0;\r\n  color: #f3f3f3;\r\n}\r\n.tips {\r\n  color: #888;\r\n  font-size: 24rpx;\r\n  margin-top: 8rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/Work/unicode/health_app/pages/group/group.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","groupService","uni","onShow"],"mappings":"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"}